# Pledge to Bank - Real Business Rotation Workflow

## ğŸ¯ Real-World Business Scenario

### Problem:
The pawn shop needs cash for business operations but doesn't have enough funds. Solution: Use the pledged items held with the shop as collateral to get financing from the bank.

### Cash Flow Cycle:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BUSINESS ROTATION CYCLE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NORMAL FLOW (No Bank Needed):
Customer â†’ Pledge Items â†’ Pawn Shop Holds â†’ Customer Pays â†’ Get Items Back

WHEN CASH NEEDED (Bank Rotation):
Customer â†’ Pledge Items â†’ Bank (as collateral) â†’ Cash to Pawn Shop
                                                        â†“
                                          Business uses cash
                                                        â†“
                                    EITHER Customer pays back
                                         OR Business gets cash
                                                        â†“
                                         Pay bank â†’ Get pledge back
                                                        â†“
                                    Return to customer
```

---

## ğŸ“Š Three Possible Redemption Scenarios

### Scenario A: BUSINESS PAYS BACK (Business has cash)
```
Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Day 1:  Pledge to Bank
        Shop: Send pledge to bank
        Bank: Give us â‚¹50,000 cash
        
Day 30: Business improves, cash available
        Shop: Pay â‚¹50,000 to bank
        Bank: Return pledge
        Shop: Still waiting for customer payment (different transaction)
        
Day 45: Customer pays â‚¹55,000 (principal + interest + extension)
        Shop: Record customer payment
        Customer: Gets pledge back
        Result: âœ“ Both settled

Ledger Impact:
â”œâ”€ Bank gives us â‚¹50,000 (improves cash flow)
â”œâ”€ Business uses â‚¹50,000 for operations
â”œâ”€ We pay back â‚¹50,000 to bank (reduces cash)
â””â”€ Customer payment â‚¹55,000 (separate transaction)
```

### Scenario B: CUSTOMER PAYS, WE PAY BANK (Customer's payment used to redeem)
```
Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Day 1:  Pledge to Bank
        Shop: Send â‚¹50,000 pledge to bank
        Bank: Give us â‚¹50,000 cash
        
Day 30: Customer pays â‚¹55,000 (more than we owe bank!)
        Shop: Receives â‚¹55,000 from customer
        Option: Pay bank â‚¹50,000 from this
        Bank: Return pledge
        Shop: Keep â‚¹5,000 as profit
        
Result: Pledge redeemed, customer settled, profit made âœ“

Ledger Impact:
â”œâ”€ Bank gives â‚¹50,000 (improves liquidity)
â”œâ”€ Customer pays â‚¹55,000 (improves cash)
â”œâ”€ We pay bank â‚¹50,000 (debt repayment)
â”œâ”€ Profit: â‚¹5,000 (income account)
â””â”€ Pledge back in our hands
```

### Scenario C: CUSTOMER + BUSINESS PAY (Split payment)
```
Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Day 1:  Pledge to Bank
        Shop: Send â‚¹50,000 pledge to bank
        Bank: Give us â‚¹50,000 cash
        
Day 15: Customer pays â‚¹30,000 (partial)
        Shop: Record receipt â‚¹30,000
        Bank: Still holding pledge (we owe â‚¹50k)
        
Day 30: Business pays remaining â‚¹20,000 to complete bank repayment
        Shop: Pay bank â‚¹20,000
        Bank: Return pledge
        Total to bank: â‚¹30k (customer) + â‚¹20k (business) = â‚¹50k âœ“
        
Result: Pledge redeemed with combined payments âœ“

Ledger Impact:
â”œâ”€ Received from customer: â‚¹30,000
â”œâ”€ Paid from business cash: â‚¹20,000
â”œâ”€ Total to bank: â‚¹50,000
â”œâ”€ Pledge redeemed: âœ“
â””â”€ Both transactions settled: âœ“
```

---

## ğŸ’¾ Updated Database Schema

### New Field in BankRedemption Model:
```python
class BankRedemption(Base):
    """Enhanced redemption model tracking source of payment."""
    
    id = Column(Integer, primary_key=True)
    bank_pledge_id = Column(Integer, ForeignKey("bank_pledges.id"))
    
    # ... existing fields ...
    
    # NEW: Track payment sources
    receipt_id = Column(Integer, ForeignKey("pledge_receipts.id"), nullable=True)
    # If customer payment used to pay bank
    
    payment_source = Column(String, default="MANUAL")
    # MANUAL: We paid from business cash
    # RECEIPT: Customer payment used
    # COMBINED: Both sources
    
    customer_payment_amount = Column(Float, default=0.0)
    # How much came from customer receipt
    
    business_payment_amount = Column(Float, default=0.0)
    # How much came from business cash
    
    status = Column(String, default="REDEEMED")
    # REDEEMED, PARTIAL, AWAITING_CUSTOMER_PAYMENT
```

---

## ğŸ“‹ API Endpoints - Enhanced

### 1. **Simple Bank Redemption** (Business pays from cash)
```http
POST /bank-pledges/{id}/redeem
Authorization: Bearer {token}

{
  "redemption_date": "2025-11-15",
  "amount_paid_to_bank": 50000.0,
  "interest_on_bank_loan": 2000.0,
  "bank_charges": 500.0,
  "actual_redemption_value": 50000.0,
  "payment_source": "MANUAL",
  "business_payment_amount": 52500.0,
  "remarks": "Business cash payment to bank"
}

RESPONSE:
{
  "id": 1,
  "bank_pledge_id": 1,
  "status": "REDEEMED",
  "payment_source": "MANUAL",
  "amount_paid": 52500.0,
  "message": "Pledge redeemed successfully. Customer payment is separate."
}
```

### 2. **Customer Receipt â†’ Bank Redemption** (Link receipt to bank redemption)
```http
POST /bank-pledges/{id}/redeem-with-receipt
Authorization: Bearer {token}

{
  "redemption_date": "2025-11-15",
  "receipt_id": 10,  # Customer payment receipt ID
  "use_receipt_amount": 50000.0,  # Amount from receipt to use for bank
  "additional_business_payment": 2500.0,  # Extra we add from business cash
  "payment_source": "COMBINED",  # RECEIPT or COMBINED
  "remarks": "Customer payment used to redeem pledge"
}

RESPONSE:
{
  "id": 1,
  "bank_pledge_id": 1,
  "receipt_id": 10,
  "status": "REDEEMED",
  "payment_source": "COMBINED",
  "customer_payment_used": 50000.0,
  "business_payment_used": 2500.0,
  "total_paid_to_bank": 52500.0,
  "message": "Pledge redeemed using customer payment + business cash"
}
```

### 3. **Mark as Awaiting Customer Payment** (If customer hasn't paid yet)
```http
POST /bank-pledges/{id}/await-customer-payment
Authorization: Bearer {token}

{
  "bank_loan_due": 50000.0,
  "expected_customer_payment": 55000.0,
  "remarks": "Waiting for customer to pay"
}

RESPONSE:
{
  "status": "AWAITING_CUSTOMER_PAYMENT",
  "bank_pledge_id": 1,
  "message": "Status set to awaiting. Customer payment will trigger auto-redemption"
}
```

### 4. **Get Bank Pledges by Payment Status**
```http
GET /bank-pledges?company_id=1&payment_status=AWAITING_CUSTOMER_PAYMENT
Authorization: Bearer {token}

RESPONSE:
{
  "awaiting_payment": [
    {
      "id": 1,
      "pledge_no": "GLD-2025-0001",
      "customer_name": "Ravi Kumar",
      "bank_loan_due": 50000.0,
      "expected_customer_payment": 55000.0,
      "days_waiting": 5
    }
  ]
}
```

---

## ğŸ”„ Automatic Redemption Workflow

### Feature: Auto-Redeem on Receipt Payment

When a receipt is created for a pledge that has an active bank pledge:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: CREATE RECEIPT FOR CUSTOMER PAYMENT                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POST /receipts                                              â”‚
â”‚ {                                                           â”‚
â”‚   pledge_id: 5,                                             â”‚
â”‚   receipt_amount: 55000,                                    â”‚
â”‚   payment_type: "Full"                                      â”‚
â”‚ }                                                           â”‚
â”‚                                                             â”‚
â”‚ System checks: Is this pledge with a bank? YES!            â”‚
â”‚                                                             â”‚
â”‚ OPTION A: AUTO MODE (Automatic)                            â”‚
â”‚ â”œâ”€ Extract â‚¹50,000 for bank payment                         â”‚
â”‚ â”œâ”€ Create bank redemption automatically                     â”‚
â”‚ â”œâ”€ Link receipt to bank redemption                          â”‚
â”‚ â”œâ”€ Update pledge status to REDEEMED                         â”‚
â”‚ â””â”€ Keep â‚¹5,000 as profit in cash account                    â”‚
â”‚                                                             â”‚
â”‚ OPTION B: MANUAL MODE (Manual confirmation needed)         â”‚
â”‚ â”œâ”€ Mark pledge as "AWAITING_BANK_REDEMPTION"               â”‚
â”‚ â”œâ”€ Show user: "Use â‚¹50,000 to redeem from bank?"           â”‚
â”‚ â”œâ”€ User confirms â†’ Proceed with auto-redemption            â”‚
â”‚ â””â”€ User declines â†’ Keep cash, update receipt separately    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULT: BOTH TRANSACTIONS SETTLED                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Customer receipt recorded                                 â”‚
â”‚ âœ“ Bank pledge redeemed                                      â”‚
â”‚ âœ“ Pledge status: REDEEMED                                   â”‚
â”‚ âœ“ Ledger entries balanced                                   â”‚
â”‚ âœ“ Profit/Loss calculated                                    â”‚
â”‚ âœ“ Cash position improved                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Ledger Journal Entries - Real Scenario

### Scenario: Customer pays â‚¹55,000, Bank loan â‚¹50,000

```
Timeline of Entries:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DAY 1: Pledge to Bank
Entry Set 1:
â”œâ”€ DR: Bank Pledge Asset (2100) = â‚¹50,000
â”œâ”€ CR: Bank Loan Payable (2200) = â‚¹50,000
â””â”€ DR: Jewelry Inventory (1500) = â‚¹50,000
   CR: Customer Receivable (1051) = â‚¹50,000

DAY 30: Customer pays â‚¹55,000
Entry Set 2:
â”œâ”€ DR: Cash (1000) = â‚¹55,000
â”œâ”€ CR: Customer Receivable (1051) = â‚¹50,000
â”œâ”€ CR: Profit on Pledge (4200) = â‚¹5,000
â””â”€ [Receipt created with status = "PENDING_BANK_REDEMPTION"]

DAY 30: Auto-Redeem from Bank (using customer payment)
Entry Set 3:
â”œâ”€ DR: Bank Loan Payable (2200) = â‚¹50,000
â”œâ”€ CR: Bank Pledge Asset (2100) = â‚¹50,000
â”œâ”€ [Link receipt to bank redemption]
â”œâ”€ [Mark receipt as "LINKED_TO_BANK_REDEMPTION"]
â””â”€ Result: Bank loan closed, pledge redeemed âœ“

FINAL LEDGER POSITION:
â”œâ”€ Cash: +â‚¹55,000 âœ“
â”œâ”€ Customer Receivable: â‚¹0 âœ“
â”œâ”€ Bank Loan: â‚¹0 âœ“
â”œâ”€ Profit: +â‚¹5,000 âœ“
â””â”€ Trial Balance: BALANCED âœ“
```

---

## ğŸ¯ Updated Business Logic

### New Validation Rules:

1. **When creating receipt for pledged-with-bank item:**
   - Check if pledge has active bank pledge
   - If yes, show option: "Use this payment to redeem from bank?"
   - If amount >= bank loan, allow auto-redemption
   - If amount < bank loan, create PARTIAL redemption

2. **When auto-redeeming:**
   - Deduct bank loan amount from receipt
   - Link receipt to bank redemption
   - Calculate profit/loss if actual price differs
   - Update both pledge and bank pledge status

3. **When creating new receipt without bank redemption:**
   - Mark receipt as "NOT_LINKED_TO_BANK"
   - Bank pledge remains active
   - Keep tracking that customer payment is pending

---

## ğŸ“± Frontend Integration

### Updated Receipt Creation Screen:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Receipt                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Select Pledge:    [GLD-2025-0001 â–¼]                 â”‚
â”‚ Customer:         Ravi Kumar (fixed)                â”‚
â”‚ Receipt Amount:   [â‚¹55,000]                         â”‚
â”‚                                                     â”‚
â”‚ âš ï¸  ALERT: This pledge is with HDFC Bank!          â”‚
â”‚    Bank Loan Due: â‚¹50,000                           â”‚
â”‚    Your Payment:  â‚¹55,000                           â”‚
â”‚                                                     â”‚
â”‚ â˜‘ Auto-redeem from bank using this payment         â”‚
â”‚  â””â”€ Profit to capture: â‚¹5,000 âœ“                     â”‚
â”‚                                                     â”‚
â”‚ OR                                                  â”‚
â”‚                                                     â”‚
â”‚ â˜ Keep this payment separate (manual redemption)   â”‚
â”‚  â””â”€ You'll redeem bank pledge separately            â”‚
â”‚                                                     â”‚
â”‚ Payment Details:                                    â”‚
â”‚ â”œâ”€ If auto-redeem:                                 â”‚
â”‚ â”‚  â”œâ”€ To Bank: â‚¹50,000                             â”‚
â”‚ â”‚  â”œâ”€ Profit: â‚¹5,000                               â”‚
â”‚ â”‚  â””â”€ Status: REDEEMED âœ“                           â”‚
â”‚ â”‚                                                  â”‚
â”‚ â”œâ”€ If manual:                                      â”‚
â”‚ â”‚  â”œâ”€ Customer Receivable: â‚¹55,000                 â”‚
â”‚ â”‚  â”œâ”€ Bank Pledge: STILL ACTIVE                    â”‚
â”‚ â”‚  â””â”€ Status: AWAITING BANK REDEMPTION             â”‚
â”‚                                                     â”‚
â”‚ [Preview] [Cancel] [Create Receipt]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dashboard Widget:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bank Pledges - Action Items                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ ğŸ¦ WITH BANK (3)                            â”‚
â”‚ â”œâ”€ GLD-0001: Awaiting customer payment      â”‚
â”‚ â”‚  Expected: â‚¹55,000 (in 5 days)           â”‚
â”‚ â”‚  Bank Loan: â‚¹50,000                      â”‚
â”‚ â”‚  [Show Receipt] [Manual Redeem]          â”‚
â”‚ â”‚                                           â”‚
â”‚ â”œâ”€ GLD-0002: Ready for redemption          â”‚
â”‚ â”‚  Business cash: â‚¹32,000 available        â”‚
â”‚ â”‚  Bank Loan: â‚¹30,000                      â”‚
â”‚ â”‚  [Redeem Now]                            â”‚
â”‚ â”‚                                           â”‚
â”‚ â””â”€ GLD-0003: Overdue by 2 days            â”‚
â”‚    Action Required! [Review] [Redeem]      â”‚
â”‚                                              â”‚
â”‚ âœ… REDEEMED (2)                             â”‚
â”‚ â”œâ”€ GLD-0004: Redeemed on 2025-11-10       â”‚
â”‚ â””â”€ GLD-0005: Redeemed on 2025-11-12       â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ Integration Points

### 1. **Receipt System Integration**
- When posting a receipt for a pledged-with-bank item
- Auto-detect bank pledge and offer redemption option
- Create bank redemption entry if user confirms
- Link receipt ID to bank redemption record

### 2. **Dashboard Integration**
- Show pledges "awaiting customer payment" with bank outstanding
- Show pledges "ready for business redemption" with cash available
- Show profit/loss if redeeming with gain/loss on valuation

### 3. **Reporting Integration**
- "Bank Pledges Summary": How much is outstanding with each bank
- "Cash Flow Report": Impact of bank pledges on liquidity
- "Profit/Loss Report": Gains/losses on pledge redemptions

---

## ğŸ§ª Test Scenarios

### Test Case 1: Happy Path (Customer pays exactly bank loan)
1. Create pledge: â‚¹50,000
2. Transfer to bank: valuation â‚¹60,000, LTV 80%, bank gives â‚¹48,000
3. Create receipt: â‚¹50,000 (to cover bank loan + interest)
4. System auto-redeems from bank
5. Verify: Both settled, no manual steps needed âœ“

### Test Case 2: Customer overpays (profit scenario)
1. Create pledge: â‚¹50,000
2. Transfer to bank: bank loan â‚¹48,000
3. Create receipt: â‚¹52,000
4. System redeems â‚¹48,000 to bank
5. Profit: â‚¹4,000 captured
6. Verify: Profit in income account âœ“

### Test Case 3: Partial payments (multiple receipts)
1. Create pledge: â‚¹50,000, transfer to bank: â‚¹48,000
2. Receipt 1: â‚¹30,000 (partial, doesn't redeem bank)
3. Receipt 2: â‚¹25,000 (combined: â‚¹30k + â‚¹25k = â‚¹55k > â‚¹48k)
4. System auto-redeems on Receipt 2
5. Verify: Both receipts linked, bank redeemed âœ“

### Test Case 4: Manual redemption (business pays, not customer)
1. Create pledge with bank: â‚¹50,000 loan
2. Business has cash, decides to pay bank directly
3. POST /bank-pledges/1/redeem (manual payment)
4. Bank redeemed, customer payment pending
5. Later: Receipt from customer (separate transaction)
6. Verify: Two independent transactions âœ“

---

## ğŸ“ Summary

This real-world scenario handles:
- âœ… Cash flow management through bank financing
- âœ… Multiple payment sources (customer + business)
- âœ… Automatic linking of receipts to bank redemptions
- âœ… Profit/loss tracking on pledge sales
- âœ… Flexible redemption strategies
- âœ… Complete audit trail
- âœ… Double-entry accounting throughout

The system supports both **automatic** and **manual** redemption strategies, allowing flexibility for different business situations!
